<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mini Jeu de Voiture</title>
  <style>
    canvas {
      display: block;
      margin: 0 auto;
      background-color: #222;
    }

    #playMusicBtn {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
    }

    #playMusicBtn:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <button id="playMusicBtn">ðŸŽµ Lancer la musique</button>
  <canvas id="gameCanvas" width="400" height="600"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const car = {
      x: canvas.width / 2 - 15,
      y: canvas.height - 60,
      width: 30,
      height: 50,
      color: "lime"
    };

    let obstacles = [];
    let speed = 3;
    let keys = {};

    const music = new Audio("assetsmusic/phonk.mp3");

    document.getElementById("playMusicBtn").addEventListener("click", () => {
      music.play();
    });

    document.addEventListener("keydown", (e) => {
      keys[e.key] = true;
    });

    document.addEventListener("keyup", (e) => {
      keys[e.key] = false;
    });

    function drawCar() {
      ctx.fillStyle = car.color;
      ctx.fillRect(car.x, car.y, car.width, car.height);
    }

    function drawObstacle(obstacle) {
      ctx.fillStyle = "red";
      ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
    }

    function moveCar() {
      if (keys["ArrowLeft"] && car.x > 0) {
        car.x -= 5;
      }
      if (keys["ArrowRight"] && car.x < canvas.width - car.width) {
        car.x += 5;
      }
    }

    function checkCollision(obstacle) {
      return (
        car.x < obstacle.x + obstacle.width &&
        car.x + car.width > obstacle.x &&
        car.y < obstacle.y + obstacle.height &&
        car.y + car.height > obstacle.y
      );
    }

    function updateGame() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawCar();
      moveCar();

      if (Math.random() < 0.02) {
        const obsWidth = 30 + Math.random() * 40;
        obstacles.push({
          x: Math.random() * (canvas.width - obsWidth),
          y: -50,
          width: obsWidth,
          height: 20
        });
      }

      for (let i = 0; i < obstacles.length; i++) {
        const obs = obstacles[i];
        obs.y += speed;

        drawObstacle(obs);

        if (checkCollision(obs)) {
          window.location.href = "index.html";
        }
      }

      // Supprimer les obstacles en dehors du canvas
      obstacles = obstacles.filter(obs => obs.y < canvas.height);

      // Augmenter progressivement la vitesse
      speed += 0.001;

      requestAnimationFrame(updateGame);
    }

    updateGame();
  </script>
</body>
</html>
